<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AyeCNSe V1.3 - 6-DOF Industrial Twin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #050507; color: #fff; font-family: 'Inter', sans-serif; }
        .jetbrains { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .accent-blue { color: #3b82f6; text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body>

    <div class="absolute inset-0 pointer-events-none z-10 flex flex-col justify-between p-6">
        <div class="flex justify-between items-start pointer-events-auto">
            <div class="glass p-5 rounded-xl border-l-4 border-blue-500">
                <h1 class="text-blue-400 font-bold text-xl tracking-tight">AyeCNSe <span class="text-white">PRO_ARM V1.3</span></h1>
                <p class="text-[10px] text-slate-400 uppercase mt-1">Status: <span class="text-green-400 animate-pulse">Ready for Sequence</span></p>
            </div>

            <div class="glass p-4 rounded-xl w-80">
                <h2 class="text-xs font-bold mb-3 text-slate-300 border-b border-slate-800 pb-2 uppercase">6-DOF State (Degrees)</h2>
                <div id="arm-telemetry" class="grid grid-cols-2 gap-x-4 gap-y-1 text-[11px] jetbrains text-blue-300">
                    <div>J1 (BASE): <span id="val-j1">0</span></div>
                    <div>J2 (SHLD): <span id="val-j2">0</span></div>
                    <div>J3 (ELBW): <span id="val-j3">0</span></div>
                    <div>J4 (PITCH): <span id="val-j4">0</span></div>
                    <div>J5 (ROLL): <span id="val-j5">0</span></div>
                    <div>J6 (YAW): <span id="val-j6">0</span></div>
                </div>
                <div class="mt-4 pt-2 border-t border-slate-800 flex justify-between text-[10px] font-bold uppercase">
                    <span>End Effector:</span>
                    <span id="val-grip" class="text-green-400">OPEN</span>
                </div>
            </div>
        </div>

        <div class="glass p-4 rounded-xl pointer-events-auto flex gap-6 h-72">
            <div class="flex-grow flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">ILM Sequence Editor</span>
                    <div class="flex gap-2 text-[10px]">
                        <button onclick="sim.setSample('pick')" class="text-blue-400 hover:underline">SAMPLE: PICK & PLACE</button>
                        <button onclick="sim.setSample('dance')" class="text-blue-400 hover:underline">SAMPLE: FLUID DANCE</button>
                    </div>
                </div>
                <textarea id="ilmInput" class="flex-grow bg-slate-950 p-4 text-xs jetbrains text-blue-100 outline-none rounded-lg border border-slate-800 resize-none leading-relaxed">
// AyeCNSe 6-DOF Sequence
// Industrial Pick and Place
ARM_BASE(45)
ARM_SHLD(20)
ARM_ELBW(40)
ARM_WRIST_P(30)
GRIP(CLOSE)
ARM_SHLD(-10)
ARM_BASE(-45)
GRIP(OPEN)</textarea>
            </div>
            <div class="w-64 flex flex-col gap-3">
                <button onclick="sim.execute()" class="h-1/2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg shadow-lg shadow-blue-900/20 transition-all uppercase tracking-tighter">Execute Batch</button>
                <div id="log" class="flex-grow bg-black/40 rounded-lg p-3 text-[10px] jetbrains text-slate-400 overflow-y-auto border border-slate-800/50">
                    > Initialize 6-Axis Kernel...<br>
                    > Digital Twin Handshake... OK
                </div>
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script>
        class AyeSim6DOF {
            constructor() {
                this.joints = {};
                this.initEngine();
                this.createIndustrialArm();
                this.createEnvironment();
                this.animate();
            }

            initEngine() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x020617);
                this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
                this.camera.position.set(8, 8, 8);
                
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.shadowMap.enabled = true;
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);

                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.scene.add(new THREE.AmbientLight(0xffffff, 0.4));
                
                const spot = new THREE.SpotLight(0xffffff, 1);
                spot.position.set(10, 20, 10);
                spot.castShadow = true;
                this.scene.add(spot);

                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            createIndustrialArm() {
                const material = new THREE.MeshPhongMaterial({ color: 0x334155, specular: 0x111111, shininess: 30 });
                const accent = new THREE.MeshPhongMaterial({ color: 0x3b82f6 });

                this.armGroup = new THREE.Group();
                
                // J1: Base
                const base = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.4, 0.4, 32), material);
                this.armGroup.add(base);
                
                this.j1 = new THREE.Group(); // Base Rotation
                this.armGroup.add(this.j1);

                // J2: Shoulder
                const lowerLink = new THREE.Mesh(new THREE.BoxGeometry(0.5, 2.5, 0.5), material);
                lowerLink.position.y = 1.25;
                this.j1.add(lowerLink);

                this.j2 = new THREE.Group(); // Shoulder Pitch
                this.j2.position.y = 2.5;
                this.j1.add(this.j2);

                // J3: Elbow
                const midLink = new THREE.Mesh(new THREE.BoxGeometry(0.4, 2.0, 0.4), material);
                midLink.position.y = 1.0;
                this.j2.add(midLink);

                this.j3 = new THREE.Group(); // Elbow Pitch
                this.j3.position.y = 2.0;
                this.j2.add(this.j3);

                // J4: Wrist Pitch
                const upperLink = new THREE.Mesh(new THREE.BoxGeometry(0.3, 1.2, 0.3), material);
                upperLink.position.y = 0.6;
                this.j3.add(upperLink);

                this.j4 = new THREE.Group(); 
                this.j4.position.y = 1.2;
                this.j3.add(this.j4);

                // J5: Wrist Roll
                this.j5 = new THREE.Group(); 
                this.j4.add(this.j5);

                // J6: Wrist Yaw / Tool Flange
                this.j6 = new THREE.Group();
                this.j5.add(this.j6);
                
                const flange = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 0.1), accent);
                flange.rotation.x = Math.PI/2;
                this.j6.add(flange);

                // Gripper (End Effector)
                this.gripper = new THREE.Group();
                const fingerGeo = new THREE.BoxGeometry(0.05, 0.4, 0.15);
                this.fL = new THREE.Mesh(fingerGeo, accent);
                this.fR = new THREE.Mesh(fingerGeo, accent);
                this.fL.position.set(-0.15, 0.2, 0);
                this.fR.position.set(0.15, 0.2, 0);
                this.gripper.add(this.fL, this.fR);
                this.j6.add(this.gripper);

                this.scene.add(this.armGroup);
            }

            createEnvironment() {
                const grid = new THREE.GridHelper(20, 20, 0x1e293b, 0x0f172a);
                this.scene.add(grid);
                
                // Target Object
                const box = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.5), new THREE.MeshPhongMaterial({color: 0xef4444}));
                box.position.set(3, 0.25, 3);
                this.scene.add(box);
            }

            log(msg) {
                const l = document.getElementById('log');
                l.innerHTML += `<div>> ${msg}</div>`;
                l.scrollTop = l.scrollHeight;
            }

            setSample(type) {
                const editor = document.getElementById('ilmInput');
                if(type === 'pick') {
                    editor.value = `// 6-DOF Pick & Place\nARM_BASE(45)\nARM_SHLD(25)\nARM_ELBW(40)\nARM_WRIST_P(30)\nGRIP(CLOSE)\nARM_SHLD(-10)\nARM_ELBW(-20)\nARM_BASE(-45)\nGRIP(OPEN)\nRESET()`;
                } else {
                    editor.value = `// Fluid Movement Demo\nARM_BASE(90)\nARM_SHLD(45)\nARM_ELBW(-45)\nARM_WRIST_P(90)\nARM_WRIST_R(180)\nARM_BASE(-90)\nRESET()`;
                }
            }

            async execute() {
                const lines = document.getElementById('ilmInput').value.split('\n');
                for(let line of lines) {
                    if (line.startsWith('//') || !line.trim()) continue;
                    const match = line.match(/(.+)\((.+)\)/);
                    if (match) {
                        const cmd = match[1].trim();
                        const val = match[2].trim();
                        await this.animateJoint(cmd, val);
                    } else if (line.trim() === 'RESET()') {
                        await this.resetArm();
                    }
                }
            }

            animateJoint(cmd, val) {
                return new Promise(res => {
                    let targetRad = (parseFloat(val) * Math.PI) / 180;
                    let targetObj, axis;

                    switch(cmd) {
                        case 'ARM_BASE': targetObj = this.j1; axis = 'y'; break;
                        case 'ARM_SHLD': targetObj = this.j2; axis = 'z'; break;
                        case 'ARM_ELBW': targetObj = this.j3; axis = 'z'; break;
                        case 'ARM_WRIST_P': targetObj = this.j4; axis = 'z'; break;
                        case 'ARM_WRIST_R': targetObj = this.j5; axis = 'y'; break;
                        case 'ARM_WRIST_Y': targetObj = this.j6; axis = 'x'; break;
                        case 'GRIP': this.toggleGrip(val); res(); return;
                        default: res(); return;
                    }

                    const start = targetObj.rotation[axis];
                    let step = 0;
                    const duration = 30;
                    const anim = () => {
                        step++;
                        targetObj.rotation[axis] = start + (targetRad - start) * (step/duration);
                        this.updateUI();
                        if(step < duration) requestAnimationFrame(anim);
                        else res();
                    };
                    anim();
                });
            }

            toggleGrip(state) {
                const isOpen = state.toUpperCase() === 'OPEN';
                this.fL.position.x = isOpen ? -0.15 : -0.05;
                this.fR.position.x = isOpen ? 0.15 : 0.05;
                document.getElementById('val-grip').innerText = state.toUpperCase();
                document.getElementById('val-grip').className = isOpen ? 'text-green-400' : 'text-red-400';
                this.log(`Gripper: ${state}`);
            }

            async resetArm() {
                this.log("System Reset...");
                this.j1.rotation.y = 0;
                this.j2.rotation.z = 0;
                this.j3.rotation.z = 0;
                this.j4.rotation.z = 0;
                this.j5.rotation.y = 0;
                this.j6.rotation.x = 0;
                this.updateUI();
            }

            updateUI() {
                const deg = r => Math.round(r * (180/Math.PI));
                document.getElementById('val-j1').innerText = deg(this.j1.rotation.y);
                document.getElementById('val-j2').innerText = deg(this.j2.rotation.z);
                document.getElementById('val-j3').innerText = deg(this.j3.rotation.z);
                document.getElementById('val-j4').innerText = deg(this.j4.rotation.z);
                document.getElementById('val-j5').innerText = deg(this.j5.rotation.y);
                document.getElementById('val-j6').innerText = deg(this.j6.rotation.x);
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
        }

        const sim = new AyeSim6DOF();
    </script>
</body>
</html>
