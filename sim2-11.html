<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AyeCNSe V2.0 - Bhangra Biped</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #020617; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .jetbrains { font-family: 'JetBrains Mono', monospace; font-size: 11px; }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div class="relative z-10 h-screen pointer-events-none flex flex-col justify-between p-6">
        <div class="glass p-5 rounded-xl border-l-4 border-yellow-500 pointer-events-auto w-fit">
            <h1 class="text-yellow-500 font-bold text-xl">AyeCNSe <span class="text-white">V2.0 JUMP_ENGINE</span></h1>
            <p class="text-[10px] text-slate-400 uppercase tracking-widest">Physics: Gravity-Enabled | Mode: Bhangra-Ready</p>
        </div>

        <div class="glass p-4 rounded-xl pointer-events-auto flex gap-4 h-72">
            <div class="flex-grow flex flex-col">
                <textarea id="ilmInput" class="flex-grow bg-slate-950 p-4 jetbrains text-yellow-100 outline-none rounded-lg border border-slate-800 resize-none">
// BHANGRA JUMP SEQUENCE
STAND()
WAIT(0.5)

// The Bhangra Prep
ARM_L_SH_ROLL(90)
ARM_R_SH_ROLL(-90)
HEAD_TILT(-20)
WAIT(0.4)

// THE JUMP
JUMP(1.5) // Vertical lift in meters
WAIT(0.5)

// Victory Pose
ARM_L_SH_PITCH(120)
ARM_R_SH_PITCH(120)
TURN(360)
WAIT(1)
RESET()</textarea>
            </div>
            <div class="w-48 flex flex-col gap-2">
                <button onclick="sim.run()" class="flex-grow bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-xl transition-all uppercase">Start Mission</button>
                <div class="bg-black/40 p-3 rounded-lg jetbrains text-[9px] text-yellow-500 border border-yellow-500/20">
                    ALT: <span id="tel-alt">0.00</span>m<br>
                    VEL: <span id="tel-vel">0.00</span>m/s
                </div>
            </div>
        </div>
    </div>

    <script>
        class BhangraSim {
            constructor() {
                this.isWalking = false;
                this.isJumping = false;
                this.jumpY = 0;
                this.velY = 0;
                this.gravity = -0.015;
                this.init();
            }

            init() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x020617);
                this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
                this.camera.position.set(5, 4, 8);
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.target.set(0, 2, 0);

                this.scene.add(new THREE.AmbientLight(0xffffff, 0.6));
                const sun = new THREE.DirectionalLight(0xffffff, 1);
                sun.position.set(5, 10, 5);
                this.scene.add(sun);
                this.scene.add(new THREE.GridHelper(30, 30, 0x1e293b, 0x0f172a));

                this.buildHumanoid();
                this.animate();
            }

            buildHumanoid() {
                this.bot = new THREE.Group();
                const mat = new THREE.MeshStandardMaterial({ color: 0x1e293b });
                const accent = new THREE.MeshStandardMaterial({ color: 0xeab308, emissive: 0x713f12 });

                this.pelvis = new THREE.Group();
                this.pelvis.position.y = 2.4;
                this.bot.add(this.pelvis);
                this.pelvis.add(new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.4, 0.6), mat));

                this.torso = new THREE.Group();
                this.torso.position.y = 0.2;
                this.pelvis.add(this.torso);
                this.torso.add(new THREE.Mesh(new THREE.BoxGeometry(1.0, 1.4, 0.7), mat));

                this.neck = new THREE.Group(); this.neck.position.y = 0.8; this.torso.add(this.neck);
                this.head = new THREE.Group(); this.neck.add(this.head);
                this.head.add(new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.5), mat));
                const visor = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.1, 0.1), accent);
                visor.position.set(0, 0.1, 0.22); this.head.add(visor);

                this.legs = { L: this.createLeg(-0.35, mat), R: this.createLeg(0.35, mat) };
                this.arms = { L: this.createArm(-0.8, mat), R: this.createArm(0.8, mat) };
                
                this.scene.add(this.bot);
            }

            createLeg(x, mat) {
                const hip = new THREE.Group(); hip.position.set(x, -0.2, 0); this.pelvis.add(hip);
                const u = new THREE.Mesh(new THREE.BoxGeometry(0.3, 1.2, 0.3), mat); u.position.y = -0.6; hip.add(u);
                const knee = new THREE.Group(); knee.position.y = -0.6; u.add(knee);
                const l = new THREE.Mesh(new THREE.BoxGeometry(0.25, 1.2, 0.25), mat); l.position.y = -0.6; knee.add(l);
                return { hip, knee };
            }

            createArm(x, mat) {
                const sh = new THREE.Group(); sh.position.set(x, 0.5, 0); this.torso.add(sh);
                const roll = new THREE.Group(); sh.add(roll);
                const u = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.8, 0.2), mat); u.position.y = -0.4; roll.add(u);
                const eb = new THREE.Group(); eb.position.y = -0.4; u.add(eb);
                const l = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.8, 0.18), mat); l.position.y = -0.4; eb.add(l);
                return { sh, roll, eb };
            }

            async run() {
                const lines = document.getElementById('ilmInput').value.split('\n');
                for(let line of lines) {
                    if (!line.trim() || line.startsWith('//')) continue;
                    const match = line.match(/(.+)\((.*)\)/);
                    if(match) {
                        const cmd = match[1].trim();
                        const val = match[2].trim();
                        await this.execute(cmd, val);
                    }
                }
            }

            async execute(cmd, val) {
                const num = parseFloat(val);
                const rad = (num * Math.PI) / 180;
                const arm = cmd.includes('_L_') ? this.arms.L : this.arms.R;

                if(cmd === 'JUMP') { this.velY = num * 0.2; this.isJumping = true; await new Promise(r => setTimeout(r, 1000)); }
                if(cmd.includes('SH_ROLL')) arm.roll.rotation.z = rad;
                if(cmd.includes('SH_PITCH')) arm.sh.rotation.x = rad;
                if(cmd === 'HEAD_TILT') this.head.rotation.x = -rad;
                if(cmd === 'TURN') {
                    const start = this.bot.rotation.y;
                    const end = start + rad;
                    for(let i=0; i<=20; i++) { this.bot.rotation.y = start + (end-start)*(i/20); await new Promise(r => setTimeout(r, 20)); }
                }
                if(cmd === 'RESET') { 
                    this.bot.rotation.y = 0; 
                    this.arms.L.roll.rotation.z = 0; this.arms.R.roll.rotation.z = 0;
                    this.arms.L.sh.rotation.x = 0; this.arms.R.sh.rotation.x = 0;
                }
                await new Promise(r => setTimeout(r, 300));
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                // Physics Engine
                if(this.isJumping || this.jumpY > 0) {
                    this.jumpY += this.velY;
                    this.velY += this.gravity;
                    if(this.jumpY <= 0) {
                        this.jumpY = 0; this.velY = 0; this.isJumping = false;
                        // Landing compression
                        this.legs.L.knee.rotation.x = 0.8; this.legs.R.knee.rotation.x = 0.8;
                        setTimeout(() => { this.legs.L.knee.rotation.x = 0.1; this.legs.R.knee.rotation.x = 0.1; }, 200);
                    }
                }

                // Apply heights
                this.bot.position.y = this.jumpY;
                document.getElementById('tel-alt').innerText = this.jumpY.toFixed(2);
                document.getElementById('tel-vel').innerText = this.velY.toFixed(2);

                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
        }
        const sim = new BhangraSim();
    </script>
</body>
</html>
